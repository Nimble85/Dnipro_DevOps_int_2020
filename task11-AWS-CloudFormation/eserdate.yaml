UserData:
    Fn:
      Fn:
        - |
          #!/bin/bash -xe
          mkdir -p /var/www/html/
          cat << EOF > /var/www/html/dbconfig.php
          <?php
          $DB_host = "${DBAddress}";
          $DB_user = "dbpdo";
          $DB_pass = "dbpdo";
          $DB_name = "dbpdo";
          try
          {
	      $DB_con = new PDO("mysql:host={$DB_host};dbname={$DB_name}",$DB_user,$DB_pass);
	      $DB_con->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
          }
          catch(PDOException $e)
          {
	      echo $e->getMessage();
          }
          include_once 'class.crud.php';
          $crud = new crud($DB_con);
          ?>
          EOF
          yum install -y aws-cfn-bootstrap
          wget -P /tmp/ https://task11.s3.eu-central-1.amazonaws.com/site.zip
          sudo unzip /tmp/site.zip -d /var/www/html
          sudo usermod -a -G apache ec2-use
          sudo chown -R ec2-user:apache /var/www/
          /opt/aws/bin/cfn-signal -e $? --stack ${AWS::StackName} --resource WebServerGroup --region ${AWS::Region}
        - {
          DBAddress: !GetAtt MySQLDatabase.PublicIp
          }

UserData:
  Fn::Base64:
    !Sub |
      #!/bin/bash -xe
      mkdir -p /var/www/html/
      cat << EOF > /var/www/html/dbconfig.php
      <?php
      $DB_host = "${DBAddress}";
      $DB_user = "dbpdo";
      $DB_pass = "dbpdo";
      $DB_name = "dbpdo";
      try
      {
      $DB_con = new PDO("mysql:host={$DB_host};dbname={$DB_name}",$DB_user,$DB_pass);
      $DB_con->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
      }
      catch(PDOException $e)
      {
      echo $e->getMessage();
      }
      include_once 'class.crud.php';
      $crud = new crud($DB_con);
      ?>
      EOF
      yum update -y aws-cfn-bootstrap
      /opt/aws/bin/cfn-init -v --stack ${AWS::StackName} --resource LaunchConfig --configsets wordpress_install --region ${AWS::Region}
      /opt/aws/bin/cfn-signal -e $? --stack ${AWS::StackName} --resource WebServerGroup --region ${AWS::Region}